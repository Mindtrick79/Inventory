{% extends 'base.html' %}
{% block content %}
<h2>Settings</h2>
<p>Application configuration. (Intended for admin users.)</p>

<form method="post" enctype="multipart/form-data">
  <div>
    <label for="company_name">Company / App Name</label>
    <input type="text" id="company_name" name="company_name" value="{{ settings.company_name }}">
  </div>

  <div>
    <label for="company_address">Company Address</label>
    <textarea id="company_address" name="company_address" rows="2">{{ settings.company_address }}</textarea>
  </div>

  <div>
    <label for="company_phone">Company Phone</label>
    <input type="text" id="company_phone" name="company_phone" value="{{ settings.company_phone }}">
  </div>

  <div>
    <label for="email_subject_prefix">Email Subject Prefix</label>
    <input type="text" id="email_subject_prefix" name="email_subject_prefix" value="{{ settings.email_subject_prefix }}">
  </div>

  <div>
    <label for="default_email_cc">Default Email CCs (comma-separated)</label>
    <input type="text" id="default_email_cc" name="default_email_cc" value="{{ settings.default_email_cc }}">
  </div>

  <div>
    <label for="email_footer">Email Footer</label>
    <textarea id="email_footer" name="email_footer" rows="3">{{ settings.email_footer }}</textarea>
  </div>

  <div>
    <label for="stock_use_notify_emails">Stock Use Notification Emails (comma-separated)</label>
    <input type="text" id="stock_use_notify_emails" name="stock_use_notify_emails" value="{{ settings.stock_use_notify_emails }}" placeholder="inventory@example.com, manager@example.com">
  </div>

  <hr>

  <h3>Branding</h3>

  <div>
    <label for="company_logo">Company Logo (PNG/JPEG)</label>
    <input type="file" id="company_logo" name="company_logo" accept="image/*">
    {% if settings.company_logo_path %}
      <div class="current-logo">
        <p>Current logo:</p>
        <img src="{{ url_for('static', filename=settings.company_logo_path) }}" alt="Company Logo" style="max-height: 60px;">
      </div>
    {% endif %}
  </div>

  <hr>

  <h3>Email Branding Preview</h3>
  <div class="email-preview">
    <p><strong>Subject:</strong> {{ settings.email_subject_prefix }}Sample Vendor</p>
    <pre style="white-space: pre-wrap; border: 1px solid #ccc; padding: 8px; background: #fafafa;">
Sample email body...

{{ settings.email_footer }}{% if settings.email_footer %}
{% endif %}{% if settings.company_name or settings.company_address or settings.company_phone %}

{{ settings.company_name }}
{{ settings.company_address }}
{{ settings.company_phone }}{% endif %}
    </pre>
  </div>

  <hr>

  <h3>Email / SMTP Setup</h3>

  <div>
    <label for="smtp_provider">Email Provider</label>
    <select id="smtp_provider" name="smtp_provider">
      {% set provider = settings.smtp_provider or 'bluehost' %}
      <option value="bluehost" {% if provider == 'bluehost' %}selected{% endif %}>Bluehost / cPanel host</option>
      <option value="gmail" {% if provider == 'gmail' %}selected{% endif %}>Gmail / Google Workspace</option>
      <option value="office365" {% if provider == 'office365' %}selected{% endif %}>Office 365 / Outlook</option>
      <option value="other" {% if provider == 'other' %}selected{% endif %}>Other (custom)</option>
    </select>
  </div>

  <div>
    <label for="from_email">From Email Address</label>
    <input type="email" id="from_email" name="from_email" value="{{ settings.from_email }}" placeholder="orders@yourdomain.com">
  </div>

  <div>
    <label for="smtp_host">SMTP Host</label>
    <input type="text" id="smtp_host" name="smtp_host" value="{{ settings.smtp_host }}" placeholder="{{ suggested_smtp_host or 'mail.yourdomain.com' }}">
  </div>

  <div>
    <label for="smtp_port">SMTP Port</label>
    <input type="number" id="smtp_port" name="smtp_port" value="{{ settings.smtp_port }}" min="1">
  </div>

  <div>
    <label for="smtp_user">SMTP Username</label>
    <input type="text" id="smtp_user" name="smtp_user" value="{{ settings.smtp_user }}" placeholder="Usually the full email address">
  </div>

  <div>
    <label for="smtp_pass">SMTP Password</label>
    <input type="password" id="smtp_pass" name="smtp_pass" placeholder="Leave blank to keep existing">
  </div>

  <div>
    <label for="smtp_use_tls">Use TLS (recommended)</label>
    <input type="checkbox" id="smtp_use_tls" name="smtp_use_tls" value="1" {% if settings.smtp_use_tls %}checked{% endif %}>
  </div>

  <div class="form-actions">
    <button type="submit" name="action" value="save">Save Settings</button>
    <button type="submit" name="action" value="autodetect">Auto-Detect SMTP from Email</button>
    <button type="submit" name="action" value="test">Send Test Email</button>
  </div>
</form>
{% endblock %}
