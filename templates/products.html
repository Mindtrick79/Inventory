{% extends 'base.html' %}
{% block content %}
<h2>Products</h2>
{% set role = session.get('role', 'VIEW') %}
{% if role == 'ADMIN' %}
<a href="{{ url_for('new_product') }}">Add New Product</a>
{% endif %}
<form method="get" class="search-form">
  <label for="q">Search</label>
  <input type="text" id="q" name="q" value="{{ query or '' }}" placeholder="Name, category, vendor, or location">
  <button type="submit">Filter</button>
  {% if query %}
    <a href="{{ url_for('products') }}">Clear</a>
  {% endif %}
</form>

{% if products %}
<table>
  <thead>
    <tr>
      <th>Image</th>
      <th>Product Name</th>
      <th>Category</th>
      <th>Quantity on Hand</th>
      <th>Container Unit</th>
      <th>Reorder Threshold</th>
      <th>Reorder Amount</th>
      <th>Reorder Quantity</th>
      <th>Distributor</th>
      <th>Location</th>
      <th>Cost Per Unit</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for p in products %}
    <tr>
      <td>
        {% if p.get('Image Path') %}
          <a href="{{ url_for('static', filename=p.get('Image Path')) }}" target="_blank" rel="noopener">
            <img src="{{ url_for('static', filename=p.get('Image Path')) }}" alt="{{ p['Product Name'] }}" class="product-thumb">
          </a>
        {% else %}
          
        {% endif %}
      </td>
      <td>{{ p['Product Name'] }}</td>
      <td>{{ p['Category'] }}</td>
      <td>{{ p['Quantity on Hand'] }}</td>
      <td>{{ p['Container Unit'] }}</td>
      <td>{{ p['Reorder Threshold'] }}</td>
      <td>{{ p['Reorder Amount'] }}</td>
      <td>{{ p['Reorder Quantity'] }}</td>
      <td>{{ p['Distributor'] }}</td>
      <td>{{ p['Location'] }}</td>
      <td>{{ p['Cost Per Unit'] }}</td>
      <td>
        {% if role == 'ADMIN' %}
          <a href="{{ url_for('edit_product', product_name=p['Product Name']) }}">Edit</a>
        {% endif %}
        {% if role in ['REQUEST', 'APPROVER', 'ADMIN'] %}
          <a href="{{ url_for('request_product', product_name=p['Product Name']) }}">Request</a>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No products found.</p>
{% endif %}
{% endblock %}
