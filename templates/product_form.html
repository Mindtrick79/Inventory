{% extends 'base.html' %}
{% block content %}
<h2>Add Product</h2>
<form method="post" enctype="multipart/form-data">
  <div>
    <label for="product_name">Product Name</label>
    <input type="text" id="product_name" name="product_name" required>
  </div>

  <div>
    <label for="category">Category</label>
    <input type="text" id="category" name="category">
  </div>

  <div>
    <label for="quantity_on_hand">Quantity on Hand</label>
    <input type="number" step="1" min="0" id="quantity_on_hand" name="quantity_on_hand" required>
  </div>

  <div>
    <label for="container_unit">Container Unit</label>
    <select id="container_unit" name="container_unit">
      <option value="">-- Select unit --</option>
      {% for u in container_units %}
        <option value="{{ u }}">{{ u }}</option>
      {% endfor %}
      <option value="__other__">Other...</option>
    </select>
    <input type="text" id="container_unit_other" name="container_unit_other" placeholder="Enter unit" style="display:none; margin-left:0.5rem;">
  </div>

  <div>
    <label for="reorder_threshold">Reorder Threshold</label>
    <input type="number" step="1" min="0" id="reorder_threshold" name="reorder_threshold">
  </div>

  <div>
    <label for="reorder_amount">Reorder Amount</label>
    <input type="number" step="1" min="0" id="reorder_amount" name="reorder_amount">
  </div>

  <div>
    <label for="reorder_quantity">Reorder Quantity (label)</label>
    <select id="reorder_quantity" name="reorder_quantity">
      <option value="">-- Select label --</option>
      {% for lbl in reorder_labels %}
        <option value="{{ lbl }}">{{ lbl }}</option>
      {% endfor %}
      <option value="__other__">Other...</option>
    </select>
    <input type="text" id="reorder_quantity_other" name="reorder_quantity_other" placeholder="Enter label" style="display:none; margin-left:0.5rem;">
  </div>

  <div>
    <label for="distributor">Distributor</label>
    <select id="distributor" name="distributor">
      <option value="">-- Select distributor --</option>
      {% for d in distributors %}
        <option value="{{ d }}">{{ d }}</option>
      {% endfor %}
      <option value="__other__">Other...</option>
    </select>
    <input type="text" id="distributor_other" name="distributor_other" placeholder="Enter distributor" style="display:none; margin-left:0.5rem;">
  </div>

  <div>
    <label for="location">Location</label>
    <input type="text" id="location" name="location" placeholder="Shop, Truck 1, etc.">
    <label for="cost_per_unit">Cost Per Unit</label>
    <input type="text" id="cost_per_unit" name="cost_per_unit" placeholder="e.g. 12.50">
  </div>

  <div>
    <label for="epa_reg_no">EPA Registration Number</label>
    <input type="text" id="epa_reg_no" name="epa_reg_no" placeholder="e.g. 12345-678">
  </div>

  <div>
    <label for="epa_est_no">EPA Establishment Number</label>
    <input type="text" id="epa_est_no" name="epa_est_no" placeholder="e.g. 98765-TX-1">
  </div>

  <div>
    <label for="product_image">Product Image (optional)</label>
    <input type="file" id="product_image" name="product_image" accept="image/png,image/jpeg,image/gif,image/webp" capture="environment">
    <div class="form-actions" style="margin-top:0.5rem;">
      <button type="button" id="camera_open_btn">Use Camera</button>
      <button type="button" id="camera_clear_btn">Clear Image</button>
    </div>
    <div id="camera_status" style="margin-top:0.5rem;"></div>
  </div>

  <div>
    <button type="submit">Save</button>
    <a href="{{ url_for('products') }}">Cancel</a>
  </div>
</form>
<script>
  function toggleOther(selectId, otherInputId) {
    var sel = document.getElementById(selectId);
    var other = document.getElementById(otherInputId);
    if (!sel || !other) return;
    if (sel.value === "__other__") {
      other.style.display = "inline-block";
      other.focus();
    } else {
      other.style.display = "none";
      other.value = "";
    }
  }

  document.getElementById('container_unit').addEventListener('change', function() {
    toggleOther('container_unit', 'container_unit_other');
  });
  document.getElementById('reorder_quantity').addEventListener('change', function() {
    toggleOther('reorder_quantity', 'reorder_quantity_other');
  });
  document.getElementById('distributor').addEventListener('change', function() {
    toggleOther('distributor', 'distributor_other');
  });
</script>

<script src="{{ url_for('static', filename='product_camera.js') }}"></script>
<script>
  (function() {
    if (window.initProductCameraCapture) {
      window.initProductCameraCapture();
    }
  })();
</script>
{% endblock %}
