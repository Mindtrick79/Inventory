{% extends 'base.html' %}
{% block content %}

<div class="page-toolbar">
  <div class="page-toolbar__title">
    <h2>Stock Use</h2>
    <div class="page-toolbar__subtitle">Record materials used so inventory can be adjusted and logged.</div>
  </div>
  <div class="page-toolbar__actions">
    <a class="btn btn--secondary" href="{{ url_for('products') }}">View Products</a>
  </div>
</div>

<form method="get" class="search-form search-form--toolbar">
  <div class="search-form__row">
    <div class="search-form__field">
      <label for="q">Search</label>
      <input type="text" id="q" name="q" value="{{ query or '' }}" placeholder="Name, category, vendor, or location">
    </div>
    <div class="search-form__actions">
      <button class="btn btn--primary btn--sm" type="submit">Filter</button>
      {% if query %}
        <a class="btn btn--secondary btn--sm" href="{{ url_for('stock_use') }}">Clear</a>
      {% endif %}
    </div>
  </div>
</form>

{% if products %}
<div class="table-wrap">
<table>
  <thead>
    <tr>
      <th>Product Name</th>
      <th>Location</th>
      <th>Quantity on Hand</th>
      <th>Unit</th>
      <th>Use Amount</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for p in products %}
    <tr>
      <td>{{ p['Product Name'] }}</td>
      <td>{{ p['Location'] }}</td>
      <td>{{ p['Quantity on Hand'] }}</td>
      <td>{{ p['Container Unit'] }}</td>
      <td>
        <form method="post" style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
          <input type="hidden" name="product_name" value="{{ p['Product Name'] }}">
          <input type="hidden" name="location" value="{{ p['Location'] }}">
          <input type="text" name="job" placeholder="Job / Customer" required>
          <input type="text" name="truck" placeholder="Truck" value="{{ session.get('default_truck','') }}">
          <input type="text" name="checkout_notes" placeholder="Notes (optional)">
          <input type="number" step="1" min="1" name="amount" style="width:4rem;" required>
          <button class="btn btn--primary btn--sm" type="submit">Used</button>
        </form>
      </td>
      <td></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
 </div>
{% else %}
<div class="empty-state">
  <div class="empty-state__title">No products found</div>
  <div class="empty-state__hint">Try adjusting your search, or add products first.</div>
</div>
{% endif %}
{% endblock %}
